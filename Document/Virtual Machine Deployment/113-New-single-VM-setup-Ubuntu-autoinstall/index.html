<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://belajarpowershell.github.io/kubernetes-lab/Document/Virtual%20Machine%20Deployment/113-New-single-VM-setup-Ubuntu-autoinstall/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>alpine1 setup and configuration. - Kubernetes Lab setup</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "alpine1 setup and configuration.";
        var mkdocs_page_input_path = "Document/Virtual Machine Deployment/113-New-single-VM-setup-Ubuntu-autoinstall.md";
        var mkdocs_page_url = "/kubernetes-lab/Document/Virtual%20Machine%20Deployment/113-New-single-VM-setup-Ubuntu-autoinstall/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Kubernetes Lab setup
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Welcome to MkDocs</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Document</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../">Index</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../scratch/">nfs for ubuntu</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Introduction</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../Introduction/000-ReadMeFirst/">000 ReadMeFirst</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Introduction/001-High-Level-node-setup/">Kubernetes lab setup - High level reference.</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Introduction/001-Hyper-V-Host-Specification/">Hyper-V-Host-Specification</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../Introduction/001-Hyper-V-VM-creation/">Hyper-V Virtual Machine Powershell script</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Pre Requisites</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../Pre%20Requisites/002-vi-basics/">002 vi basics</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Virtual Machine Deployment</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="./">alpine1 setup and configuration.</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../114-generate-user-data-multipleVM/">114 generate user data multipleVM</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../114-generate-user-data-reference/">114 generate user data reference</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Alpine1</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/100-alpine1-setup/">Initial Alpine OS setup - alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/101-DHCP-server/">Install and Configure DHCP - alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/102-setup-router/">Configure as a Router  -alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/103-setup-dns/">Configure DNS server - alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/104-setup-nginx/">Install and Configure nginx - alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/105-nfs/">Install and Configure nfs- alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/106-tftp/">Install and Configure tftpd - alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/107-cloud-init/">Install and Configure cloud-init - alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/108-DHCP-for-PXE/">update DHCP options to provide PXE boot information to clients. - alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/109-setup-boot-files-part1/">Part 1 of 4  Setup boot files for PXELINUX and OS boot- alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/110-setup-boot-files-part2-PXE/">Part 2 of 4  Setup boot files for PXELINUX - alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/111-setup-boot-files-part3-OS/">Part 3 of 4 Setup OS Boot files - alpine1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../alpine1/112-setup-boot-files-part4-pxelinux.cfg/">Part 4 of 4 Configure the boot menu pxelinux.cfg/default - alpine1</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Draft</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../draft/200-setup-alpine-LB/">Setup Alpine Load balancer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../draft/9108-alpine1-setup-pxe-bootmenu%20copy/">alpine1 setup and configuration.</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../draft/9108-alpine1-setup-pxe-bootmenu/">alpine1 setup and configuration.</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../draft/999-alpine1-DHCP-set-hostname/">alpine1 setup and configuration.</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../draft/argo-cd/">Argo cd</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../draft/kubernetes-upgrade/">Kubernetes upgrade</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Ad login</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../draft/ad-login/001-k3s-setup/">001 k3s setup</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../draft/ad-login/azure-ad-setup/">Azure ad setup</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../draft/ad-login/entra-app-registration-aks-cli-kubectl/">Entra app registration aks cli kubectl</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../draft/ad-login/kubectl-kubelogin/">Kubectl kubelogin</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../draft/ad-login/kubectl-login-ad/">Kubectl login ad</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../draft/ad-login/test-ad-authentication/">Test ad authentication</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../draft/ad-login/windows-install-az-cli/">Windows install az cli</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">K3s deployment</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../k3s-deployment/200-Ansible-setup/">200 Ansible setup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../k3s-deployment/201-k3s-setup/">201 k3s setup</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Kubernetes Lab setup</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Document</li>
          <li class="breadcrumb-item">Virtual Machine Deployment</li>
      <li class="breadcrumb-item active">alpine1 setup and configuration.</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="alpine1-setup-and-configuration"><code>alpine1</code> setup and configuration.</h1>
<h1 id="ubuntu-autoinstall-on-single-vm">Ubuntu Autoinstall on single VM</h1>
<p>One other aspect I was looking at is to automate all the servers to access the configuration files that is reference with the hostname,IP,gateway and Disk config.
This way every time I have to rebuild the lab, it will be quicker. </p>
<p>I understand from the Ubuntu <a href="https://ubuntu.com/server/docs/install/autoinstall">Automated Server installation</a> that there is a change from version 20.04 a new method is implemented. As such most of the information gathered are from the Ubuntu forums.</p>
<h3 id="these-are-some-references-i-used-to-prepare-the-autoinstall-configuration">These are some references I used to prepare the autoinstall configuration</h3>
<p><a href="https://ubuntu.com/server/docs/install/autoinstall-quickstart">autoinstall-quickstart</a></p>
<p><a href="https://askubuntu.com/questions/1290624/fetch-autoinstall-based-on-mac">fetch-autoinstall-based-on-mac</a></p>
<h4 id="lets-get-to-the-details">Lets get to the details</h4>
<p>The autoinstall  requires <code>user-data</code> , <code>vendor-data</code> and <code>meta-data</code>. The <code>meta-data</code> and , <code>vendor-data</code>  are blank files. 
<code>user-data</code> however must be populated with some valid content.
In the file <code>/srv/tftp/efi64/pxelinux.cfg/default</code>, the append row below looks for the <code>user-data</code> and <code>meta-data</code> we need to ensure these file exists is referenced here.</p>
<pre><code>`autoinstall ds=nocloud-net;s=http://192.168.100.1/autoinstalldata/`
</code></pre>
<p>Example of <code>user-data</code>. This was obtained from a manual installation of <code>ubuntu-20.04.6-live-server-amd64.iso</code>.
The file <code>autoinstall-user-data</code> is found in the folder <code>/var/log/installer/autoinstall-user-data</code>.
It is best to generate one to store the relevant configurations and then customize based on individual server requirements.</p>
<p>Lets create this file.</p>
<pre><code># this is a blank file
touch /srv/autoinstall/meta-data
touch /srv/autoinstall/vendor-data
touch /srv/autoinstall/user-data

vi /srv/autoinstall/user-data

#cloud-config
autoinstall:
  apt:
    disable_components: []
    geoip: true
    preserve_sources_list: false
    primary:
    - arches:
      - amd64
      - i386
      uri: http://my.archive.ubuntu.com/ubuntu
    - arches:
      - default
      uri: http://ports.ubuntu.com/ubuntu-ports
  drivers:
    install: false
  identity:
    hostname: master1
    password: $5$1hs/5SKiGm.zNbWk$Ap5W6Tc.YCaALtSp1INrLmYD/GIpRemhpRwtZIZCSO9
    realname: ss
    username: ubuntu
  kernel:
    package: linux-generic
  keyboard:
    layout: us
    toggle: null
    variant: ''
  locale: en_US.UTF-8
  network:
    ethernets:
      eth0:
        addresses:
        - 192.168.100.202/24
        gateway4: 192.168.100.1
        nameservers:
          addresses:
          - 192.168.100.1
          search: []
    version: 2
  ssh:
    allow-pw: true
    authorized-keys: []
    install-server: true
  storage:
    config:
    - ptable: gpt
      path: /dev/sda
      wipe: superblock
      preserve: false
      name: ''
      grub_device: false
      type: disk
      id: disk-sda
    - device: disk-sda
      size: 1127219200
      wipe: superblock
      flag: boot
      number: 1
      preserve: false
      grub_device: true
      type: partition
      id: partition-0
    - fstype: fat32
      volume: partition-0
      preserve: false
      type: format
      id: format-0
    - device: disk-sda
      size: 2147483648
      wipe: superblock
      flag: ''
      number: 2
      preserve: false
      grub_device: false
      type: partition
      id: partition-1
    - fstype: ext4
      volume: partition-1
      preserve: false
      type: format
      id: format-1
    - device: disk-sda
      size: 50410291200
      wipe: superblock
      flag: ''
      number: 3
      preserve: false
      grub_device: false
      type: partition
      id: partition-2
    - name: ubuntu-vg
      devices:
      - partition-2
      preserve: false
      type: lvm_volgroup
      id: lvm_volgroup-0
    - name: ubuntu-lv
      volgroup: lvm_volgroup-0
      size: 25203572736B
      wipe: superblock
      preserve: false
      type: lvm_partition
      id: lvm_partition-0
    - fstype: ext4
      volume: lvm_partition-0
      preserve: false
      type: format
      id: format-2
    - path: /
      device: format-2
      type: mount
      id: mount-2
    - path: /boot
      device: format-1
      type: mount
      id: mount-1
    - path: /boot/efi
      device: format-0
      type: mount
      id: mount-0
  updates: security
  version: 1

</code></pre>
<p>Generate the crypted password using the command below. The result will change with every run as there is salting present in the code.You don't have to do this if you are extracting the <code>user-data</code> from an existing installation.</p>
<pre><code>mkpasswd --method=sha-512 123 # 123 is the password in this example

</code></pre>
<h2 id="validate">Validate</h2>
<p>Validate <code>user-data</code> using the command below.</p>
<pre><code>cloud-init schema --config-file user-data
</code></pre>
<p>We now have all the files in place for a machine to start up and autoinstall ubuntu.</p>
<p>With the setup in place you can now start the Virtual Machine <code>master1</code>, the network boot will present the Menu, select the option <code>ubuntu-iso-local</code> the VM will boot up with and the installation will complete without manual input.</p>
<h4 id="video-overview-on-the-ubuntu-autoinstall-process">Video overview on the Ubuntu Autoinstall process .</h4>
<p>This a video covering the initial boot, Ubuntu installation and the booting to the newly installed Ubuntu.
<a href="https://clipchamp.com/watch/5HU0H7YUsnU">Autoinstall-Ubuntu-master1</a></p>
<h1 id="update-to-include-new-link">update to include new link</h1>
<h2 id="troubleshooting-steps">Troubleshooting steps.</h2>
<p>As I performed the configuration, I faced some issues , and the following had configuration errors mostly. i.e. wrong IP, typos etc.</p>
<ul>
<li>
<p>check dhcp
 Ensure the IP Addresses are assigned correctly.</p>
</li>
<li>
<p>Check nginx
 You can use the access log to check if a URL has been accessed. This way you can guess where the errors could be.</p>
</li>
<li>
<p>Ensure Virtual Machine specifications meet the minimum requirements.</p>
</li>
</ul>
<p>I had set the Memory to 512MB and enabled Dynamic memory of 512MB to 2048GB but this caused the autoinstall to crash and not complete.</p>
<ul>
<li>
<p>if you choose <code>ubuntu-iso-remote</code> ensure VM has minimum 4GB of memory to load the Ubuntu OS setup. This is for the ISO to be extracted to memory.</p>
</li>
<li>
<p>URL path incorrect
  Many times I found myself making simple mistakes in the path. Double check if you did the same too.</p>
</li>
<li>
<p><code>meta-data</code> and <code>vendor-data</code> not created or path configured does not have <code>meta-data</code> and <code>vendor-data</code> </p>
</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../Pre%20Requisites/002-vi-basics/" class="btn btn-neutral float-left" title="002 vi basics"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../114-generate-user-data-multipleVM/" class="btn btn-neutral float-right" title="114 generate user data multipleVM">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>&copy; 2024 <a href="https://github.com/belajarpowershell"  target="_blank" rel="noopener">Suresh Solomon</a></p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../Pre%20Requisites/002-vi-basics/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../114-generate-user-data-multipleVM/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
